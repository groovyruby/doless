<%= form_for [@project, @ticket], :html=>{:multipart=>true} do |f| %>
  <% content_for :head do %>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      nested_forms['asset'] = "<%#= generate_template(f, :assets) %>";
    });
  </script>
  <% end %>

  <% if @ticket.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@ticket.errors.count, "error") %> prohibited this ticket from being saved:</h2>

      <ul>
      <% @ticket.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :title %><br />
    <%= f.text_field :title, :class=>"textfield medium" %>
  </div>
  <div class="field">
    <%= f.label :description %><br />
    <%= f.text_area :description, :size=>"60x10" %>
  </div>
  <div class="field">
    <%= f.label :priority %><br />
    <%= f.select :priority, Ticket::PRIORITIES %>
  </div>
  <% unless f.object.new_record? %>
  <div class="field">
    <%= f.label :status %><br />
    <%= f.select :status, Ticket.state_machines[:default].statuses_for_select %>
  </div>
  <% end %>
  <ul id="assets_fields">
     <%#= f.fields_for :assets do |fp| %>
         <%#= render :partial=>"asset", :locals=>{:f=>fp}%>
     <%# end %>
  </ul>
  <a name="asset"></a>
  <%= link_to 'Add asset', '#asset', :class => "add_nested_item", :rel => "asset" %><br />

  <div class="actions">
    <%= f.submit :class=>"button" %>
  </div>
<% end %>

